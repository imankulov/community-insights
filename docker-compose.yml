version: "2.1"
services:
  web:
    image: imankulov/community-insights:latest
    build: .
    env_file: ./.env
    ports:
      - "127.0.0.1:8000:8000"
    restart: on-failure
    volumes:
      # requisites for Google Cloud
      - "./.docker-compose/credentials.json:/credentials/credentials.json:ro"
      # development mapping
      - ".:/community-insights/"

  redis:
      image: redis:alpine
      volumes:
        - ./.docker-compose/redis/data:/data
      ports:
        - "127.0.0.1:6379:6379"

  postgres:
    image: "postgres:9.6-alpine"
    environment:
      POSTGRES_USER: insights
      POSTGRES_PASSWORD: password
      POSTGRES_DB: insights
    volumes:
      - ./.docker-compose/postgres/data:/var/lib/postgresql/data
    ports:
      - "127.0.0.1:5432:5432"
